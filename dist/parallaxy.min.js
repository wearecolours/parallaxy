var Parallaxy=function(){function a(){return this.allElements=[],this.init=function(){this.getElements(),this.update()},this.refresh=function(){this.allElements=[],this.init()},this.getElements=function(){var a,b,c,d,e,f,g,h=document.querySelectorAll("[data-parallaxy]");for(a=0,d=h.length;d>a;a++){for(f=h[a].childNodes,this.allElements[a]={container:h[a],childrens:[],maxspeed:null===h[a].getAttribute("data-parallaxy-maxspeed")?.9:parseFloat(h[a].getAttribute("data-parallaxy-maxspeed")),minspeed:null===h[a].getAttribute("data-parallaxy-minspeed")?.1:parseFloat(h[a].getAttribute("data-parallaxy-minspeed"))},c=0,b=0,e=f.length;e>b;b++)1===f[b].nodeType&&null===f[b].getAttribute("data-parallaxy-ignore")&&(g="IMG"===f[b].tagName||"VIDEO"===f[b].tagName,this.allElements[a].childrens[c]={element:f[b],scalable:null===f[b].getAttribute("data-parallaxy-dontresize")?g:!1,ready:!0,scale:1,originalWidth:0,originalHeight:0},g&&("VIDEO"===f[b].tagName?0===f[b].videoWidth?(this.allElements[a].childrens[c].ready=!1,this.allElements[a].childrens[c].element.addEventListener("loadedmetadata",this.loadedImage.bind(this,this.allElements[a].childrens[c]))):(this.allElements[a].childrens[c].originalWidth=this.allElements[a].childrens[c].element.style.width=f[b].videoWidth,this.allElements[a].childrens[c].originalHeight=this.allElements[a].childrens[c].element.style.height=f[b].videoHeight):0===f[b].naturalWidth?(this.allElements[a].childrens[c].ready=!1,this.allElements[a].childrens[c].element.addEventListener("load",this.loadedImage.bind(this,this.allElements[a].childrens[c]))):(this.allElements[a].childrens[c].originalWidth=this.allElements[a].childrens[c].element.style.height=f[b].style.naturalHeight,this.allElements[a].childrens[c].originalHeight=this.allElements[a].childrens[c].element.style.width=f[b].style.naturalWidth)),c++);var i=this.allElements[a].maxspeed-this.allElements[a].minspeed;for(b=0;b<this.allElements[a].childrens.length;b++){var j=this.allElements[a].childrens[b].element;null===j.getAttribute("data-parallaxy-speed")?1===this.allElements[a].childrens.length?this.allElements[a].childrens[b].speed=(this.allElements[a].maxspeed+this.allElements[a].minspeed)/2:this.allElements[a].childrens[b].speed=this.allElements[a].minspeed+1/(this.allElements[a].childrens.length-1)*b*i:this.allElements[a].childrens[b].speed=Math.min(1,Math.max(0,parseFloat(j.getAttribute("data-parallaxy-speed"))))}}},this.loadedImage=function(a){a.ready=!0,"VIDEO"===a.element.tagName?(a.element.setAttribute("width",a.element.videoWidth),a.element.setAttribute("height",a.element.videoHeight),a.originalWidth=childrens[j].videoWidth,a.originalHeight=childrens[j].videoHeight):(a.originalHeight=a.element.style.height=a.element.style.naturalHeight,a.originalWidth=a.element.style.width=a.element.style.naturalWidth),this.update()},this.update=function(){this.updateSize(),this.updateScroll()},this.updateSize=function(){var a,b,c,d,e,f,g;for(b=0,d=this.allElements.length;d>b;b++)for(a=this.allElements[b].childrens,f=this.allElements[b].container.offsetHeight,g=this.allElements[b].container.offsetWidth,c=0,e=a.length;e>c;c++)if(a[c].scalable&&a[c].ready){var h=(window.innerHeight+f)*a[c].speed,i=h+f-2*f*a[c].speed,j=g,k=j/a[c].originalWidth,l=i/a[c].originalHeight;a[c].adjustVerticalAlignToCenter=l>k?0:a[c].originalHeight*(k-l)/2,a[c].scale=Math.max(k,l)}},this.updateScroll=function(){var a,b,c,d,e,f,g=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0);for(c=0,e=this.allElements.length;e>c;c++){a=this.allElements[c].childrens;var b=this.allElements[c].container.offsetTop-g;for(d=0,f=a.length;f>d;d++)if(a[d].ready){var h=-(a[d].speed*b)-a[d].adjustVerticalAlignToCenter,i=.5*-(a[d].originalWidth*a[d].scale-this.allElements[c].container.offsetWidth);a[d].element.style.webkitTransform=a[d].element.style.MozTransform=a[d].element.style.msTransform=a[d].element.style.transform="translate("+i+"px, "+h+"px) scale("+a[d].scale+")"}}},document.addEventListener("DOMContentLoaded",this.init.bind(this)),window.addEventListener("resize",this.update.bind(this)),window.addEventListener("scroll",this.updateScroll.bind(this)),this.prototype}return new a}();